<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bitcoin Payment ‚Äì CPN Creator</title>
  <style>
  body {
    font-family: Arial, sans-serif;
    background: #000;
    color: #fff;
    padding: 40px;
    margin: auto;
    max-width: 700px;
    box-sizing: border-box;
  }

  h1 {
    font-size: 2em;
  }

  .price-line {
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 1.4em;
    font-weight: bold;
    margin: 15px 0;
  }

  #btcAmount {
    color: orange;
    cursor: pointer;
  }

  .btc-section {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    margin: 15px 0;
  }

  .btc-address {
    background: #222;
    padding: 14px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.25em;
    font-weight: bold;
    word-wrap: break-word;
    max-width: 100%;
  }

  #qrcode img {
    width: 120px;
    height: 120px;
  }

  label {
    display: block;
    margin-top: 20px;
    font-weight: bold;
  }

  input, select, button {
    display: block;
    width: 100%;
    box-sizing: border-box;
    padding: 12px;
    margin-top: 8px;
    border-radius: 4px;
    border: none;
    font-size: 1em;
  }

  button {
    background: linear-gradient(90deg, #28a745, #218838);
    color: white;
    font-size: 1.2em;
    margin-top: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  button:hover {
    background: #1e7e34;
    transform: scale(1.03);
  }

  #confirmation, #timerBox {
    display: none;
    margin-top: 30px;
    background: #e0ffe0;
    padding: 30px;
    border-left: 6px solid green;
    font-size: 1.1em;
    color: #000;
  }

  #notice {
    color: red;
    font-weight: bold;
  }

  progress {
    width: 100%;
    height: 30px;
    margin-top: 15px;
  }

  #downloadLink {
    display: none;
    margin-top: 20px;
    text-align: center;
  }

  #thankYouMessage {
    display: none;
    margin-top: 30px;
    font-size: 1.2em;
    line-height: 1.4;
    text-align: center;
  }

  a, a:visited, a:hover, a:active {
    color: #fff;
    text-decoration: none;
  }

  .spinner {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 40px;
    height: 40px;
    margin: -20px 0 0 -20px;
    border: 4px solid #fff;
    border-top-color: transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  #orderPopup {
    position: fixed;
    left: 30px;
    top: 50%;
    transform: translateY(-50%);
    background: #1f2937;
    color: #10b981;
    padding: 14px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    font-size: 0.95rem;
    font-weight: 500;
    display: none;
    z-index: 9999;
    transition: opacity 1s ease;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50%      { opacity: 0; }
  }

  .blink {
    animation: blink 1s step-start infinite;
  }

  @media (max-width: 768px) {
    .price-line,
    .btc-section {
      flex-direction: column;
      align-items: flex-start;
    }

    .btc-section {
      gap: 10px;
    }

    h1, h3 {
      font-size: 1.5em;
    }

    .price-line {
      font-size: 1.2em;
    }

    .btc-address {
      font-size: 1.1em;
      word-break: break-word;
    }

    #qrcode img {
      width: 100px;
      height: 100px;
    }

    button {
      font-size: 1em;
    }

    label, input, select {
      font-size: 1em;
    }

    input, select, label {
      margin-bottom: 14px;
    }

    #orderPopup {
      left: 10px;
      right: 10px;
      width: auto;
      font-size: 0.85rem;
    }

    #features ul {
      font-size: 0.95rem;
    }

    #thankYouMessage {
      font-size: 1em;
      padding: 10px;
    }
  }
</style>

</head>
<body>

  <div id="features" style="background: #111827; padding: 20px 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.4);">
  <h3 style="color: #38bdf8; margin-bottom: 12px; font-size: 1.3rem;">üîé What You Get:</h3>
  <ul style="list-style: none; padding-left: 0; line-height: 1.8; font-size: 1.05rem;">
    <li>‚úÖ <strong>AI-Powered CPN Generator</strong> ‚Äì Built on SSA validation logic</li>
    <li>üîê <strong>Reused Number Scanner</strong> ‚Äì Flagged CPN protection included</li>
    <li>üñ•Ô∏è <strong>License (Device-Locked)</strong> ‚Äì One-time activation</li>
    <li>‚ôªÔ∏è <strong>Lifetime Updates + Priority Support</strong> ‚Äì Always up to date</li>
  </ul>
</div>

<p style="color: #16a34a; font-size: 0.95rem; text-align: center; margin-bottom: 20px;">üéâ Trusted by 100+ users ‚Äî Last confirmed order: <span id="recentTime">2 minutes ago</span></p>

<div class="price-line" style="margin-top: 10px;">
  <span>Price: <span id="usdPrice" style="color: #00ff00;"></span></span>
  <span id="btcAmount">‚âà Loading BTC...</span>
</div>

<p id="notice" style="color: #f87171; font-weight: bold;">
  Please send the exact amount shown above.
</p>

<div class="btc-section">
  <div class="btc-address" title="Click to copy">
  bc1qtfxzerwdm0wv6v7akvx0h0ksqvx7ycuhaxqa5y
</div>
  <p style="margin-top: 10px; font-size: 0.9em; color: #9ca3af;">
    üìã Click address to copy
  </p>
  <div id="qrcode">
    <img src="https://raw.githubusercontent.com/cpncreator/cpncreator.github.io/main/assets/qrcode.png" alt="QR Code">
  </div>
</div>

<div id="orderPopup">

  ‚úÖ Last confirmed order: <span id="randomMinutes">2</span> minutes ago
</div>
<div id="paymentSection">
  <form id="paymentForm">
    <label for="email">Your Email</label>
    <input type="email" id="email" required>

    <label for="os">Windows or Mac Version?</label>
    <select id="os" required>
      <option value="">Select...</option>
      <option value="Windows">Windows</option>
      <option value="Mac">Mac</option>
    </select>

    <label for="txid">Transaction ID</label>
    <input type="text" id="txid" required>
    <span id="txidFeedback"></span>

    <button type="submit" disabled>Submit</button>
<div id="policy">
  üîí SSL secured checkout &nbsp;|&nbsp; 14-day money-back guarantee if unsatisfied
</div>

  </form>
</div>

  <div id="confirmation">
  <p><strong>‚úÖ Payment submission received!</strong></p>
  <p>We're tracking your BTC confirmation now. Once it hits 6 confirmations, your download will unlock automatically.</p>
  <p>Need help or have questions? Contact us anytime:</p>
  <p>Email ‚Äì <strong>Coding-planet@proton.me</strong> | WhatsApp ‚Äì <strong>(818) 617-6711</strong></p>
</div>

  <div id="timerBox">
    <p style="font-size: 1.3em; font-weight: bold;">‚è≥ Close this page after confirmation is completed!</p>
    <progress id="progressBar" value="0" max="6"></progress>
  </div>

  <div id="downloadLink"></div>
  <div id="thankYouMessage">
    Your download has started. If you have any questions or did not get your download, you can send us a message on the following.
<p>Email - <strong>Coding-planet@proton.me</strong> | Whatsapp ONLY - <strong>(818) 617-6711</strong></p>
  </div>

<!-- make sure you have this in your <head> so Email.send is available -->
<script src="https://smtpjs.com/v3/smtp.js"></script>
  
<script>
  console.log('‚öôÔ∏è CPN Creator script loaded');

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CONFIG ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  const apiToken        = '68cd7b8dcabf4598941296b9f1e09b34';
  const callMeBotApiKey = '1474937';
  const callMeBotPhone  = '18186176711';
  const PRICE_USD       = 399;
  const BTC_API         = 'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd';
  const CONFIRM_API     = id => `https://api.blockcypher.com/v1/btc/main/txs/${id}`;
  const DOWNLOAD_URLS   = {
    Windows: 'https://raw.githubusercontent.com/cpncreator/cpncreator.github.io/main/assets/CPN%20-%20Creator%20WI%20(3).zip',
    Mac:     'https://cleddoffshores.com/Mac/cpncreatormac.zip'
  };

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî STATE ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  let userEmail = '';
  let userOS    = '';
  let userTxid  = '';

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî HELPERS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî

  // Copy BTC address
  function copyBTC() {
    navigator.clipboard.writeText('bc1qtfxzerwdm0wv6v7akvx0h0ksqvx7ycuhaxqa5y')
      .then(() => alert("üìã Address copied"))
      .catch(() => alert("‚ùå Copy address failed"));
  }

  // Copy BTC price (no ‚Äú‚âà‚Äù)
  function copyBTCPrice() {
    let txt = document.getElementById('btcAmount').textContent.trim();
    txt = txt.replace(/^‚âà\s*/, '');
  txt = txt.replace(/\s*BTC$/, '');
    navigator.clipboard.writeText(txt)
      .then(() => alert(`üìã Copied price: ${txt}`))
      .catch(() => alert("‚ùå Copy price failed"));
  }

  // Fetch BTC ‚Üî USD rate
  function fetchBTCPrice() {
    const el = document.getElementById('btcAmount');
    fetch(BTC_API)
      .then(res => {
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        return res.json();
      })
      .then(data => {
        const rate = data.bitcoin.usd;
        const amt  = (PRICE_USD / rate).toFixed(8);
        el.textContent = `‚âà ${amt} BTC`;
        el.title = "Click to copy price";
      })
      .catch(err => {
        console.error('Error loading BTC price:', err);
        el.textContent = '‚ö†Ô∏è Error loading BTC';
      });
  }

  // Blink + realistic ‚ÄúX minutes/hours ago‚Äù
  function updateRecentTime() {
    const el = document.getElementById('recentTime');
    el.classList.add('blink');
    const min = 5, max = 360;
    const total = Math.floor(Math.random() * (max - min + 1)) + min;
    if (total < 60) {
      el.textContent = `${total} minutes ago`;
    } else {
      const hrs = Math.floor(total / 60), mins = total % 60;
      let txt = hrs === 1 ? '1 hour' : `${hrs} hours`;
      if (mins) txt += ` ${mins} minutes`;
      el.textContent = `${txt} ago`;
    }
  }

  // Send email via SMTPJS
  function sendProtonEmail() {
    Email.send({
      SecureToken: apiToken,
      To:          'Coding-planet@proton.me',
      From:        'Coding-planet@proton.me',
      Subject:     'New CPN Creator Payment',
      Body:        `You have a new payment submission:<br/>
                    ‚Ä¢ Email: ${userEmail}<br/>
                    ‚Ä¢ OS: ${userOS}<br/>
                    ‚Ä¢ TXID: ${userTxid}`
    })
    .then(msg => console.log('‚úÖ ProtonMail sent:', msg))
    .catch(err => console.error('‚ùå ProtonMail error:', err));
  }

  // Send WhatsApp via CallMeBot
  function sendWhatsAppNotification() {
    const message = `‚úÖ New payment received!\nEmail: ${userEmail}\nOS: ${userOS}\nTXID: ${userTxid}`;
    const url = `https://api.callmebot.com/whatsapp.php?phone=${callMeBotPhone}`
              + `&text=${encodeURIComponent(message)}`
              + `&apikey=${callMeBotApiKey}`;
    fetch(url)
      .then(res => console.log('‚úÖ WhatsApp sent:', res.status))
      .catch(err => console.error('‚ùå WhatsApp error:', err));
  }

  // Poll on-chain confirmations
  async function pollConfirmations(txid, os) {
    const bar = document.getElementById('progressBar');
    try {
      const res  = await fetch(CONFIRM_API(txid));
      if (!res.ok) throw new Error(res.statusText);
      const { confirmations = 0 } = await res.json();
      bar.value = Math.min(confirmations, bar.max);
      if (confirmations >= bar.max) {
        showDownload(os);
      } else {
        setTimeout(() => pollConfirmations(txid, os), 10000);
      }
    } catch (err) {
      console.error('‚ùå Confirmation check failed:', err);
      setTimeout(() => pollConfirmations(txid, os), 10000);
    }
  }

  // Show download spinner + fetch + start download
  function showDownload(os) {
    const url = DOWNLOAD_URLS[os];
    const confBox = document.getElementById('confirmation');

    // add spinner
    const spinner = document.createElement('div');
    spinner.className = 'spinner';
    confBox.appendChild(spinner);

    fetch(url)
      .then(res => {
        if (!res.ok) throw new Error('Network error');
        return res.blob();
      })
      .then(blob => {
        spinner.remove();
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = `CPNCreator_${os}.zip`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(blobUrl);
      })
      .catch(err => {
        console.error('‚ö†Ô∏è Download failed, fallback:', err);
        spinner.remove();
        window.location.href = url;
      })
      .finally(() => {
        // clean up UI
        document.getElementById('confirmation').style.display = 'none';
        document.getElementById('timerBox').style.display     = 'none';
        const ty = document.getElementById('thankYouMessage');
        ty.style.display  = 'block';
        ty.style.position = 'fixed';
        ty.style.top      = '50%';
        ty.style.left     = '50%';
        ty.style.transform= 'translate(-50%, -50%)';
      });
  }

  // On form submit: notify, reveal progress, then poll
  function handlePaymentSubmit(e) {
    e.preventDefault();
    userEmail = document.getElementById('email').value;
    userOS    = document.getElementById('os').value;
    userTxid  = document.getElementById('txid').value.trim();

    sendProtonEmail();
    sendWhatsAppNotification();

    // remove everything above
    ['features','notice','policy'].forEach(id => document.getElementById(id)?.remove());
    document.querySelector('.price-line')?.remove();
    document.querySelector('.btc-section')?.remove();
    document.getElementById('orderPopup')?.remove();
    document.getElementById('recentTime')?.closest('p')?.remove();
    document.getElementById('paymentSection').style.display = 'none';

    // show confirmation & bar
    document.getElementById('confirmation').style.display = 'block';
    document.getElementById('timerBox').style.display     = 'block';
    document.getElementById('progressBar').value          = 0;

    pollConfirmations(userTxid, userOS);
  }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî INIT ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('usdPrice').textContent = `$${PRICE_USD}`;
    fetchBTCPrice();
    document.getElementById('btcAmount').addEventListener('click', copyBTCPrice);
    document.querySelector('.btc-address').addEventListener('click', copyBTC);

    // blink timestamp
    const rt = document.getElementById('recentTime');
    rt.classList.add('blink');
    updateRecentTime(); // update once
// no setInterval ‚Äî no repeated changes

    // TXID live validation
    const txidInput = document.getElementById('txid');
    const feedback  = document.getElementById('txidFeedback');
    const submitBtn = document.querySelector('#paymentForm button');
    txidInput.addEventListener('input', () => {
      const ok = /^[A-Fa-f0-9]{64}$/.test(txidInput.value.trim());
      feedback.textContent = ok ? '‚úÖ Looks good!' : '‚ùå Invalid TXID';
      feedback.style.color = ok ? 'lightgreen' : 'salmon';
      submitBtn.disabled = !ok;
    });

    // form submit
    document.getElementById('paymentForm')
            .addEventListener('submit', handlePaymentSubmit);
  });
</script>

  </body>
</html>
